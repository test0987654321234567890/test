<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Cache-Control" content="no-cache">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>LIFFツール</title>
        <link rel="icon" href="https://obs.line-scdn.net/0hrKkn3t_FLWRWFz-5ynlSMwRKJgZldTNvdCM5AzZocTAzTAxSbw8baSxCGjAzcghZIRAEQzVoAT96RgxSNiQHAzp_FTB6TBxzLSQXcjhEBiQ9XDZoYg0S"/>
    </head>
    <body>
        <style id="style">
            body {
                background-color: #222;
                margin: 0px;
            }

            div#main{
                margin: 8px; 
                flex-grow: 1;
            }
            body,a,a:visited {
                color: #fff;
            }

            button {
                padding: 4px 12px;
                outline: none;
                border-radius: 3px;
                background-color: #06c755;
                font-size: 12px;
                line-height: 24px;
                font-weight: 700;
                color: #fff;
                border: none;
                margin: 2px;
            }

            .select {
                padding: 4px 12px;
                outline: none;
                border-radius: 3px;
                font-size: 12px;
                line-height: 24px;
                font-weight: 700;
                margin: 2px;
                color: #06c755;
                background-color: #fff;
                border: none;
            }

            .unicpad {
                padding: 4px 12px;
                outline: none;
                border-radius: 3px;
                font-size: 12px;
                line-height: 24px;
                font-weight: 700;
                margin: 2px;
                color: #000;
                background-color: #fff;
                border: none;
            }

            .cannot_use {
                padding: 4px 12px;
                outline: none;
                border-radius: 3px;
                font-size: 12px;
                line-height: 24px;
                font-weight: 700;
                margin: 2px;
                color: #fff;
                background-color: #666;
                border: none;
            }

            input,textarea,pre,select {
                flex: 1 1 auto;
                line-height: 30px;
                padding: 0 4px 0 13px;
                font-size: 16px;
                font-weight: 400;
                outline: none;
                border: solid 1px #aaa;
                border-radius: 5px;
                margin: 0 5px;
            }
            textarea{
                width: 98%;
            }

            iframe {
                border: 1px solid black;
                width: 100%;
                height: 100%;
            }


            * {
                box-sizing: border-box;
            }

            header.header {
                padding: 5px 1% 0px;
                position: fixed;
                top: 0;
                background-color: #06c755;
                width: 100vw;
                justify-content: space-between;
                padding: 2px 15px;
                align-items: center;
            }
            header.err {
                padding: 0px 0% 0px;
                margin: 65px 0px;
                position: fixed;
                top: 1;
                width: 95%;
                background-color: rgba(0, 0, 0, 0);
                display: flex;
                align-items: center;
            }

            h1.headh {
                margin: 0;
                padding: 0;
                font-size: 20px;
            }

            a.heada {
                text-decoration: none;
                color: #fff;
                font-size: 15px;
            }
            .waku{
  padding-top: 4px;
  padding: 5px;
  border: 5px solid;
  border-radius: 8px; 
  margin-bottom: -5px;
}

            nav {
                margin: 0 0 0 0;
            }
            .scroll {
                overflow-x: scroll;
            }
            .list {
                width: 100%;
                min-width: 850px;
                display: flex;
                list-style: none;
                margin: 0;
                padding-inline-start: 0px;
            }
            li {
   margin: 0 0 0 25px;
   font-size: 14px;
}
            h5.head5{
                margin-block-start: 5px;
                margin-block-end: 5px;
            }
            td{
                padding: 1px 10px;
            }
            
        </style>
        <div id="head">
        <header id="header" class="header header_liff">
            <span id="name"><h1 class="headh">LIFFツール</h1></span>
            <nav >
                <div class="scroll">
                    <ul class="list">
                        <li><h5 class="head5"><a class="heada" href="#toke">Token関係</a></h5></li>
                        <li><h5 class="head5"><a class="heada" href="#unico">ユニコ連投</a></h5></li>
                        <li><h5 class="head5"><a class="heada" href="#unik">ユニコ解析</a></h5></li>
                        <li><h5 class="head5"><a class="heada" href="#flexid">Flex/Json送信</a></h5></li>
                        <li><h5 class="head5"><a class="heada" href="#flex_temp">Flexテンプレート</a></h5></li>
                        <li><h5 class="head5"><a class="heada" href="#ocurl">OCリンク変換</a></h5></li>
                        <li><h5 class="head5"><a class="heada" href="#help">使い方・ヘルプ</a></h5></li>
                      </ul>
                  </div>
            </nav>
        </header>
    </div>
    <div id="for-pc"></div>
        <div id="main">
            <header class="err" id="errbar">
                <span id="err"></span>
            </header>
            <br id="toke">
            <br>
            <br>
            <div class="waku">
            <h3 >Token関係</h3>
            <p>
                liff-token:<input type="text" id="token" value=""><button type="button" onclick=set()>設定</button>
            </p>
            <button type="button" onclick=pc()>tokenを転送</button><button type="button" onclick=clos()>tokenを保持して閉じる(a)</button><button type="button" onclick=openB()>ブラウザで開く</button>
            <p>
                メッセージ送信<input type=text id=test value="てすと"><button type="button" name="sendmsg" onclick=cansend(test)>送信</button>
            </p>
            </div>
            <br id="unico">
            <br>
            <div class="waku">
            <h3>ユニコ連投</h3>
            <p>投下間隔:<input type="number" id="rate" size="5" value="700">ミリ秒</p>
            <p>投下回数:<input type="number" id="loop" size="5" value="700">回</p>
            <p>ユニコの形式</p>
            <select id="unitype" onchange=check()>
              <option value="text">通常ユニコ</option>
              <option value="flex">flexユニコ(OCでは5回以上連投でポリます)</option>
              <option value="pre">プレビュー(結果を表示します)</option>
            </select><br>
    <span id="but"><button type="button" onclick=cansend(rununi) name="sendmsg" >連投開始</button></span><button type="button" onclick=check2() >最大文字数</button><button type="button" onclick=cansend(rununi2) name="sendmsg"  >ユニコ手動投下</button>
    <p>前につける文字列<input type="text" id="1str" size="20" value="" oninput=check()></p>
    <p>　　　　+</p>
    <p>ユニコ<input type="text" id="uni" size="20" value="͢" oninput=check()><button type="button" onclick=uniPad() >ユニコ一覧</button></p>
    <p>重ねる回数<input type="number" id="xint" size="5" value="10000" oninput=check()></p>
    <p>　　　　+</p>
    <p>後につける文字列<input type="text" id="2str" size="20" value="" oninput=check()></p>
    <div id="uniout"></div>
    <div id="uniPad"></div>
    <p >「ブラウザで開く」を押して外部ブラウザで開けば重くなりません</p>
    </div>
    <br id="unik"><br>
    <div class="waku">
    <h3>ユニコ解析</h3>
    <p>解析するユニコ <input type="text" id="unicode" size="20" value="" oninput=uniK()><button type="button" onclick=uniK() >解析</button></p>
    <p id="flex">結果：</p>
    <div id="spam"></div><div id="res"></div></div>
    <br id="flexid">
    <br>
    <div class="waku">
    <h3>Flex/Json送信</h3>
    <textarea id="flexJson" rows="10" cols="40" onblur="seikei()" ></textarea>
    <br><button type="button" onclick=flexSend(1) name="sendmsg"  >送信</button><button type="button" onclick=flexSend(2) >jsonを共有</button><button type="button" onclick='clip("flexJson")' >jsonをコピー</button><button type="button" onclick='seikei(1)' >jsonエラーを確認</button><br>
        <h3>画像url生成</h3>
        <p><a href="line://nv/profile">アイコン画像を変換する画像にして</a>、変換を押してurlに変換できます。変換したurlはアイコンを再度変更しても変わりません。</p>
        <button type="button" onclick= cansend(img2url) name="sendmsg">変換</button>
        <div id="img_url"></div></div>
        <br id="flex_temp">
        <br>
        <div class="waku">
        <h3>Jsonテンプレート</h3>
        
        <h3>画像メッセージ</h3>
        <p>プレビュー画像<input type="text" id="Gpre" size="20" value="https://obs.line-scdn.net/0hrKkn3t_FLWRWFz-5ynlSMwRKJgZldTNvdCM5AzZocTAzTAxSbw8baSxCGjAzcghZIRAEQzVoAT96RgxSNiQHAzp_FTB6TBxzLSQXcjhEBiQ9XDZoYg0S/f256x256"></p>
        <p>表示画像<input type="text" id="Gimg" size="20" value="https://obs.line-scdn.net/0hrKkn3t_FLWRWFz-5ynlSMwRKJgZldTNvdCM5AzZocTAzTAxSbw8baSxCGjAzcghZIRAEQzVoAT96RgxSNiQHAzp_FTB6TBxzLSQXcjhEBiQ9XDZoYg0S"></p>
        <button type="button" onclick= cansend(Gout) name="sendmsg" >トークに送信</button><button type="button" onclick=Gout2()>jsonを出力</button></div><br><br>
        <div class="waku">
        <h3>あいさつメッセージ</h3>
        <p>通知メッセージ<input type="text" id="Balt" size="20" value="よろしくお願いします"></p>
        <p>あいさつ文<input type="text" id="Binfo" size="20" value="よろしくお願いします"></p>
        <p>ボタン名<input type="text" id="BbutName" size="20" value="大事なノートを見る"></p>
        <p>ボタンuri<input type="text" id="BbutUri" size="20" value="https://line.me"></p>
        <button type="button" onclick= cansend(Bout) name="sendmsg" >トークに送信</button><button type="button" onclick=Bout2()>jsonを出力</button>
        </div><br><br>
        <div class="waku">
        <h3>投票箱</h3>
        <p>通知メッセージ<input type="text" id="Valt" size="20" value="[投票] "></p>
        <p>タイトル<input type="text" id="Vtitle" size="20" value="[投票] "></p>
        <p>説明文<input type="text" id="Vinfo" size="20" value="投票に参加してみましょう"></p>
        <p>ボタン名<input type="text" id="VbutName" size="20" value="投票する"></p>
        <p>ボタンuri<input type="text" id="VbutUri" size="20" value="https://line.me"></p>
        <p>投票uri<input type="text" id="Vuri" size="20" value="https://line.me"></p>
        <p>画像url<input type="text" id="VimgUrl" size="20" value="https://scdn.line-apps.com/n/_1/poll/static/icon-message-1024.971665e3.png"></p>
        <button type="button" onclick= cansend(Vout) name="sendmsg" >トークに送信</button><button type="button" onclick=Vout2()>jsonを出力</button>
        </div><br><br>
        
        <div class="waku">
        <h3>ライブトーク</h3>
        <p>通知メッセージ<input type="text" id="Lalt" size="20" value="ライブトークが始まりました"></p>
        <p>タイトル<input type="text" id="Ltitle" size="20" value="オープンチャット"></p>
        <p>説明文<input type="text" id="Linfo" size="20" value="ライブトークが始まりました。ライブに参加してみましょう。"></p>
        <p>ボタン名<input type="text" id="LbutName" size="20" value="ライブトークに参加"></p>
        <p>ボタンuri<input type="text" id="LbutUri" size="20" value="https://line.me"></p>
        <p>オプ画像url<input type="text" id="LimgUrl" size="20" value="https://obs.line-scdn.net/0hrKkn3t_FLWRWFz-5ynlSMwRKJgZldTNvdCM5AzZocTAzTAxSbw8baSxCGjAzcghZIRAEQzVoAT96RgxSNiQHAzp_FTB6TBxzLSQXcjhEBiQ9XDZoYg0S/f256x256"></p>
        <button type="button" onclick= cansend(Lout) name="sendmsg" >トークに送信</button><button type="button" onclick=Lout2()>jsonを出力</button>
        </div><br><br>
        
        <div class="waku">
        <h3>オープンチャット利用制限</h3>
        <p>通知メッセージ<input type="text" id="Oalt" size="20" value="オープンチャット利用制限：１日間"></p>
        <p>タイトル<input type="text" id="Otitle" size="20" value="オープンチャット利用制限：１日間"></p>
        <p>説明文<input type="text" id="Oinfo" size="20" value="運営への批判などが含まれたコンテンツをシェアした疑いがあるため、サービスの利用が制限されました。禁止事項に関する詳細は、以下のリンクをご確認ください。"></p>
        <p>ボタン名<input type="text" id="ObutName" size="20" value="安心・安全ガイドライン"></p>
        <p>ボタンuri<input type="text" id="ObutUri" size="20" value="https://line.me"></p>
        <p>サービスuri<input type="text" id="Ourl" size="20" value="https://line.me"></p>
        <button type="button" onclick= cansend(Oout) name="sendmsg" >トークに送信</button><button type="button" onclick=Lout2()>jsonを出力</button>
        </div><br><br>
        
        <div class="waku">
        <h3>オープンチャット招待</h3>
        <p>通知メッセージ<input type="text" id="Ialt" size="20" value="オープンチャットに招待されました"></p>
        <p>タイトル<input type="text" id="Ititle" size="20" value="オープンチャット"></p>
        <p>説明文<input type="text" id="Iinfo" size="20" value="招待されました。"></p>
        <p>ボタン名<input type="text" id="IbutName" size="20" value="参加する"></p>
        <p>ボタンuri<input type="text" id="IbutUri" size="20" value="https://line.me"></p>
        <p>オプ画像url<input type="text" id="IimgUrl" size="20" value="https://obs.line-scdn.net/0hrKkn3t_FLWRWFz-5ynlSMwRKJgZldTNvdCM5AzZocTAzTAxSbw8baSxCGjAzcghZIRAEQzVoAT96RgxSNiQHAzp_FTB6TBxzLSQXcjhEBiQ9XDZoYg0S/f256x256"></p>
        <button type="button" onclick= cansend(Iout) name="sendmsg" >トークに送信</button><button type="button" onclick=Iout2()>jsonを出力</button>
        </div><br>
        <br id="ocurl">
        <br><div class="waku">
        <h3>OCリンク変換</h3>
        <p>url:<input type="url" id="url">
            <button type="button" onclick= OCurl()>変換</button></p>
            <p>変換する形式</p><select id="outtype">
              <option value="line://">line://</option>
              <option value="https://line.me/R/">https://line.me/R/</option>
              <option value="https://line.me/S/">https://line.me/S/(LINEからのみ利用可)</option>
              <option value="https://line.naver.jp/R/">https://line.naver.jp/R/</option>
              <option value="https://line.naver.jp/S/">https://line.naver.jp/S/(LINEからのみ利用可)</option>
            </select>
            <p>変換結果</p>
            <p>urlの形式:<span id="type"></span></p>
            <p>通報リンク<br><input type="text" id="rep" size="20" onclick={this.select();this.focus();}><button type="button" onclick='clip("rep")' >コピー</button></p>
            <p>参加リンク<br><input type="text" id="join" size="20" onclick={this.select();this.focus();}><button type="button" onclick='clip("join")' >コピー</button></p>
            <p>招待リンク<br><input type="text" id="inv" size="20" onclick={this.select();this.focus();}><button type="button" onclick='clip("inv")' >コピー</button></p>
            <p>webデータ<br><input type="text" id="squ" size="20" onclick={this.select();this.focus();}><button type="button" onclick='clip("squ")' >コピー</button></p>
            <p>ticket<br><input type="text" id="tic" size="20" onclick={this.select();this.focus();}><button type="button" onclick='clip("tic")' >コピー</button></p>
            </div>
            <br id="mylis"><br>
            <div class="waku">
                <h3>MyList偽装</h3>
                <p>OCのMyListを生成します</p>
                <p>url:<input id="oclisturl" type="url"></p>
                <p>最終更新表示:<input id="octime" type="text" value="たった今"></p>
                <select id="memtype">
                    <option value="">メンバー</option>
                    <option value="suboperator">副官</option>
                    <option value="operator">管理者</option>
                  </select>
                <button type="button" onclick='addoclist()'>追加</button><button type="button" onclick='addoclist("del")'>全削除</button>
                <div id="ocframe"><iframe src="./oclist.html"  id="oclist"></iframe></div>
                <button type="button" onclick='document.getElementById("ocframe").requestFullscreen()'>拡大</button>
            </div>
            <br id="ip"><br>
            <div class="waku">
                <h3>IP特定画像生成</h3>
                <p>flexや画像メッセージの画像urlとして送ると相手のipを取得して現在のトークに送信するurlを生成します</p>
                <p>元画像url:<input id="ipurl" type="url"></p>
                <p>通知コード:<input id="ipcode" type="text" value="ip抜き"></p>
                <button type="button" name="sendmsg" onclick='cansend(ip)'>生成</button>
                <p><input type="text" id="ipout"></p>
            </div>
            <br id="logs"><br>
            <div class="waku">
                <h3>ログ</h3>
                <textarea id="logview" rows="10" cols="40" ></textarea>
                <button type="button" onclick='clip("logview")' >ログをコピー</button><br>
            </div>
            <br id="help"><br>
            <div class="waku">
            <h3>ヘルプ</h3>
            <p>
                <a href="https://line.me/R/oaMessage/@228jbgfo/">バグ報告・質問等はこちらへ</a>
            </p></div>
    </div>
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
        <script src="./mod.js"></script>
        <script>
            if (navigator.userAgent.includes("LIFF")){
                document.getElementById("name").innerHTML=""
            }
            if (window.innerWidth>900){
                let sty=document.createElement("style");
                sty.innerHTML=`div#main{
                margin: 30px;
            }`;
                document.body.appendChild(sty)
            }
        </script>
        <script>

function ip() {
    let url=document.getElementById("ipurl").value;
    let code=document.getElementById("ipcode").value;
    document.getElementById("ipout").value=`https://pilok1ng.pythonanywhere.com/api/img?mode=ip&token=${liffmod.accessToken}&code=${encodeURIComponent(code)}&url=${encodeURIComponent(url)}`
}


            var errtimer,errtimer_,can_msgsend,tokenkey,loop;
            var logs=[];
            liffmod.init().then(()=>{
                liffmod.isToken(liffmod.accessToken).then((scope)=>{
                    console.log(scope)
                    scope.forEach(element => {
                        if (element=="chat_message.write"){
                            logbar("初期化に成功しました<br>メッセージを送信できます");
                            can_msgsend=true
                        }
                    });
                    if (!can_msgsend){
                        nomsg()
                }})
            }).catch((e)=>{
                if (getParam("t")){
                    gett(getParam("t")).then((t)=>{
                        return liffmod.setAccessToken(t);
                    }).then(()=>{
                        logbar("初期化に成功しました<br>メッセージを送信できます");
                        can_msgsend=true
                        document.getElementById('token').value = liffmod.accessToken;
                    }).catch((err)=>{
                        nomsg()
                    })
                }else{
                    nomsg()
            }
                
    //        }).then(()=>{
    //if (!(location.protocol=="file:")){
    //if (!Cookies.get("isAgree")) {
    //    location.href = "./agree.html" + location.hash
    //}
    //}
            }).then(()=>{
                if(liffmod.accessToken){
                document.getElementById('token').value = liffmod.accessToken;}
            })


            function pc() {
                if (!tokenkey){
                shortt(liffmod.accessToken).then((key)=>{
                    tokenkey=key;
    open("https://line.me/R/share?text="+encodeURIComponent("https://liff-tool.f5.si/?t="+key));})}
                    else{
                        open("https://line.me/R/share?text="+encodeURIComponent("https://liff-tool.f5.si/test/?t="+tokenkey))
                    }
}
function openB() {
    if(!tokenkey){
    shortt(liffmod.accessToken).then((key)=>{
        tokenkey=key;
    open("https://liff-tool.f5.si/?t="+key);
    })}
    else{
        open("https://liff-tool.f5.si/test/?t="+tokenkey);
    }
}

function clos() {
    open("https://x.gd/8WPF7")
}
function test() {
    let test = document.getElementById('test').value;
    liffmod.sendTextMessage(test).then(()=>{logbar("送信しました")}).catch((e)=>{errbar("送信できませんでした: "+e)})
}
function set() {
    liffmod.setAccessToken(document.getElementById('token').value).then(()=>{
                liffmod.isToken(liffmod.accessToken).then((scope)=>{
                    console.log(scope)
                    scope.forEach(element => {
                        if (element=="chat_message.write"){
                            logbar("初期化に成功しました<br>メッセージを送信できます");
                            yesmsg()
                        }
                    });
                    if (!can_msgsend){
                        nomsg()
                }})
            }).catch((e)=>{
                nomsg()
            })
}
function OCurl() {
    let url = document.getElementById("url").value;
    let type = "不正なurlです";
    let tic;
    let urll = 0;
    let out=document.getElementById("outtype").value;
    url = url.replace("line.me/ti/g2/", "line://ti/g2/");
    url = url.replace("line.me/S/", "line://");
    url = url.replace("line.me/R/", "line://");
    url = url.replace("line.naver.jp/R/", "line://");
    url = url.replace("line.naver.jp/S/", "line://");
    url = url.replace("http://", "");
    url = url.replace("https://", "");
    urll = url.lastIndexOf("line://");
    url = url.substr(urll);
    if (url.substr(7, 6) == "ti/g2/") {
        type = "招待リンク";
        let s = url.substr(13);
        tic = "";
        for (var i = 0; i < s.length; ++i) {
            if (s.charAt(i) == "?") {
                break
            } else {
                tic = tic + s.charAt(i)
            }
        }
    } else if (url.substr(7, 14) == "square/report?") {
        type = "通報リンク";
        tic = "";
        let s = url.substr(21);
        s = s.substr(s.lastIndexOf("ticket=") + 7);
        s = s + "&";
        s = s.substring(0, s.indexOf("&"));
        tic = s;
    } else if (url.substr(7, 12) == "square/join?") {
        type = "参加リンク";
        tic = "";
        let s = url.substr(19);
        s = s.substr(s.lastIndexOf("ticket=") + 7);
        s = s + "&";
        s = s.substring(0, s.indexOf("&"));
        tic = s;
    }
    if (tic) {
        document.getElementById("rep").value = out+"square/report?ticket=" + tic;
        document.getElementById("join").value = out+"square/join?ticket=" + tic;
        document.getElementById("inv").value = "https://line.me/ti/g2/" + tic;
        document.getElementById("squ").value = "https://square-api.line.me/smw/v2/static/sm/html/#/squareCover/" + tic + "?isTicket=true";
        document.getElementById("type").innerHTML = type;
        document.getElementById("tic").value = tic;
    } else {
        document.getElementById("type").innerHTML = "不正なurlです";
    }
    logbar("プレビューを読み込んでいます...")
    fetch("https://piloking-api.deno.dev/"+tic).then((res)=>res.json()).then((json)=>{
        if(json.err){
            document.getElementById("ocview").innerHTML = ``;
            errbar("プレビューを読み込めませんでした: エラー "+json.err)
        }else{
        logbar("プレビューを読み込みました")
        document.getElementById("ocview").innerHTML = `<p>オプチャ名:${json.title}</p><p>背景画像</p><input type="text" id="ocimg" size="20" value="https://obs.line-scdn.net/${json.obs}"><button type="button" onclick='clip("ocimg")' >コピー</button><br><img src="https://obs.line-scdn.net/${json.obs}/preview" alt="" width="200" height="200">`;
}})
    
}

function rununi() {
    if (document.getElementById("unitype").value!="pre"){
    document.getElementById('but').innerHTML = "<button type=\"button\" onclick=stop()>連投停止</button>";
    let msg = document.getElementById("uni").value;
    let bef = document.getElementById("1str").value;
    let aft = document.getElementById("2str").value;
    let x = document.getElementById("xint").value;
    let xx = document.getElementById("loop").value;
    let rate = document.getElementById("rate").value;
    if (xx == 0) {
        document.getElementById("xxint").value = 1;
        document.getElementById('but').innerHTML = "<button type=\"button\" onclick=rununi() >連投開始</button>";
        return;
    }
    msg = msg.repeat(x);
    msg = bef + msg + aft;
    if (document.getElementById("unitype").value=="flex"){
        msg={
                    "type": "flex",
                    "altText": bef+aft,
                    "contents": {
                        "type": "carousel",
                        "contents": [{
                            "type": "bubble",
                            "body": {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [{
                                    "type": "text",
                                    "text": msg,
                                    "wrap": true,
                                    "size": "xl",
                                    "weight": "bold",
                                }]
                            }
                        }]
                    }
                };
    }else{
        msg={type:"text",text:msg}
    }
    loop=true;
    loopSleep(xx, rate, function(i) {
        sendUni(msg);
        document.getElementById('loop').value = xx - i - 1;
    });
    function sendUni(msg) {
        liffmod.sendMessages([msg,msg,msg,msg,msg]).then(()=>{
            logbar("送信しました")
        }).catch((err)=>{
            errbar("送信できませんでした: "+err)
        })
    }
}else{
    errbar("エラー")
}
}
function stop() {
    loop=false;
    logbar("連投停止しました");
    document.getElementById('but').innerHTML =`<button type="button" onclick=cansend(rununi) name="sendmsg" >連投開始</button>`
}

function rununi2() {
    if (document.getElementById("unitype").value!="pre"){
    let msg = document.getElementById("uni").value;
    let bef = document.getElementById("1str").value;
    let aft = document.getElementById("2str").value;
    let x = document.getElementById("xint").value;
    msg = msg.repeat(x);
    msg = bef + msg + aft;
    if (document.getElementById("unitype").value=="flex"){
        msg={
                    "type": "flex",
                    "altText": bef+aft,
                    "contents": {
                        "type": "carousel",
                        "contents": [{
                            "type": "bubble",
                            "body": {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [{
                                    "type": "text",
                                    "text": msg,
                                    "wrap": true,
                                    "size": "xl",
                                    "weight": "bold",
                                }]
                            }
                        }]
                    }
                };
    }else{
        msg={type:"text",text:msg}
    }
        liffmod.sendMessages([msg]).then(()=>{
            logbar("送信しました")
        }).catch((err)=>{
            errbar("送信できませんでした: "+err)
        })
}else{
    errbar("エラー")
}
}

function uniPad() {
    let unico = ["꙰⃟","ܑ", "ܰ", "ܱ", "ܲ", "ܳ", "ܴ", "ܵ", "ܶ", "ܷ", "ܸ", "ܹ", "ܺ", "ܻ", "ܼ", "ܽ", "ܾ", "ܿ", "݀", "݁", "݂", "݃", "݄", "݅", "݆", "݇", "݈", "݉", "݊", "ૺ", "ૻ", "ૼ", "ੈ", "଼", "ิ", "ุ", "ฺ", "้", "ີ", "ⷣ", "ⷵ", "ⷨ", "֦", "֘"];
    let uniP = document.getElementById("uniPad");
    let unibut = "";
    uniP.innerHTML = "";
    for (var i = 0; i < unico.length; ++i) {
        unibut = unibut + `<button type="button" onclick=setuni("${unico[i]}") class="unicpad" >${unico[i]}</button>`;
    }
    uniP.innerHTML = unibut;
}
function setuni(u) {
    document.getElementById("uni").value = document.getElementById("uni").value + u;
    check();
}
function check2() {
    document.getElementById("xint").value = 17000;
    check()
}
function check() {
    var msg = document.getElementById("uni").value.length;
    var bef = document.getElementById("1str").value.length;
    var aft = document.getElementById("2str").value.length;
    var x = document.getElementById("xint").value;
    var len = bef + aft + msg * x;
    if (document.getElementById("unitype").value=="flex"){
    if (len > 16900) {
        document.getElementById("xint").value = Math.floor((16900 - bef - aft) / msg);
        x = document.getElementById("xint").value;
        len = bef + aft + msg * x;
        logbar("自動修正しました:" + bef + "+" + msg + "x" + x + "+" + aft +"="+len);
    } else {
        logbar(bef + "+" + msg + "x" + x + "+" + aft +"="+len);
    }}else{
        if (len > 10000) {
        document.getElementById("xint").value = Math.floor((10000 - bef - aft) / msg);
        x = document.getElementById("xint").value;
        len = bef + aft + msg * x;
        logbar("自動修正しました:" + bef + "+" + msg + "x" + x + "+" + aft +"="+len);
    } else {
        logbar(bef + "+" + msg + "x" + x + "+" + aft +"="+len);
    }
    }
    if (document.getElementById("unitype").value=="pre"){
        msg = document.getElementById("uni").value;
        bef = document.getElementById("1str").value;
        aft = document.getElementById("2str").value;
        x = document.getElementById("xint").value;
        msg = msg.repeat(x);
        msg = bef + msg + aft;
        document.getElementById("uniout").innerHTML=`結果<input value="${msg}" type="text" size="20" id="uni_out" onclick={this.select();this.focus();} ><button type="button" onclick=clip("uni_out") >コピー</button>`
    }else{
        document.getElementById("uniout").innerHTML=""
    }
}

function img2url() {
    liffmod.getProfile().then((res)=>{
    if (res.pictureUrl){
        document.getElementById("img_url").innerHTML=`<p>変換結果</p><img src="${res.pictureUrl}" alt="img" width="200" height="200" ><p>url: <input type="text" id="profileimg" size="20" value="${res.pictureUrl}"><button type="button" onclick='clip("profileimg")' >コピー</button></p>`
    }
}).catch((err)=>{errbar("画像を取得できませんでした: "+err)})
}
function uniK() {
    let unicode=document.getElementById("unicode").value;
    document.getElementById("res").innerHTML="";
    unico = [...unicode];
    for (let i = 0; i < unico.length; i++) {
        let u=unico[i];
        if (!document.getElementById(u)){
            document.getElementById("res").innerHTML=document.getElementById("res").innerHTML+`<p>ユニコ<input type="text" size="20" value="${u}" onclick={this.select();this.focus();} >×数量<input type="number" id="${u}" size="20" value="0"></p>`
        }
    }
    for (let i = 0; i < unico.length; i++) {
        let u=unico[i];
        if (document.getElementById(u)){
            document.getElementById(u).value=parseInt(document.getElementById(u).value,10)+1;
        }
    }
    if(unico.length>2){
    let spam=unico[Math.floor(unico.length/2)]+unico[Math.floor((unico.length/2)+1)];
    document.getElementById("spam").innerHTML=`<p>フィルター用<input type="text" size="20" id="uni_k" value="${spam}" onclick={this.select();this.focus();} ><button type="button" onclick='clip("uni_k")' >コピー</button>`
    }else{
        document.getElementById("spam").innerHTML=`<p>フィルター用<input type="text" size="20" id="uni_k" value="${unicode}" onclick={this.select();this.focus();} ><button type="button" onclick='clip("uni_k")' >コピー</button>`
    }
}

function seikei(mode) {
    try {
    let msg = document.getElementById("flexJson").value;
    msg = JSON.parse(msg);
    msg = JSON.stringify(msg,null,2);
    document.getElementById("flexJson").value = msg;
    if(mode==1){
        logbar("エラーなし")
    }
} catch (error) {
    error=error.toString();
    errbar(error);
    if(error.indexOf("position ")!=-1){
        error=error.substring(error.indexOf("position ")+9)
        error=error.substring(0,error.indexOf(" ("))
        error=Number(error)
        if(mode==1){
        let input=document.getElementById("flexJson");
        input.focus();
        input.setSelectionRange(error,error+1)
    }
    }

}
}
function flexSend(type) {
    seikei();
    let msg = document.getElementById("flexJson").value;

    Cookies.set('rawjson', msg, {
        expires: 50
    });
    let jmsg = JSON.parse(msg);
    if (type == 1) {
        liffmod.sendMessages(jmsg).then(()=>{
            logbar("送信しました")
        }).catch((err)=>{
            errbar("送信できませんでした: "+err)
        });
    }else if(type==2){
        open("line://share?text="+encodeURIComponent(msg))
    }
}

function Gout() {
    var pre = document.getElementById("Gpre").value;
    var img = document.getElementById("Gimg").value;
    document.getElementById("flexJson").value = `[{ "type": "image", "originalContentUrl": "${img}", "previewImageUrl": "${pre}"}]`
    flexSend(1);
}

function Gout2() {
    var pre = document.getElementById("Gpre").value;
    var img = document.getElementById("Gimg").value;
    document.getElementById("flexJson").value = `[{ "type": "image", "originalContentUrl": "${img}", "previewImageUrl": "${pre}"}]`
    logbar("jsonを出力しました");
    seikei();
}

function Bout() {
    var alt = document.getElementById("Balt").value;
    var info = document.getElementById("Binfo").value;
    var butName = document.getElementById("BbutName").value;
    var butUri = document.getElementById("BbutUri").value;
    document.getElementById("flexJson").value = `[{"type":"flex","altText":"${alt}","contents":{"type":"bubble","direction":"ltr","styles":{"header":{"separatorColor":"#ffffff"},"body":{"separator":false,"separatorColor":"#ffffff"},"footer":{"separator":false,"separatorColor":"#ffffff"}},"body":{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${info}","size":"sm","color":"#000000","weight":"regular","style":"normal","decoration":"none","wrap":true,"margin":"none"}],"spacing":"sm","backgroundColor":"#ffffff","borderColor":"#ffffff","paddingTop":"11px","paddingBottom":"7px","paddingStart":"14px","paddingEnd":"14px"},"footer":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","flex":1,"text":"${butName}","size":"xs","align":"center","gravity":"center","color":"#111111","weight":"bold","style":"normal","wrap":true,"position":"relative"}],"spacing":"11px","backgroundColor":"#f5f5f5","cornerRadius":"7px","height":"35px","action":{"type":"uri","label":"uri","uri":"${butUri}"}}],"spacing":"11px","position":"relative","paddingTop":"7px","paddingBottom":"14px","paddingStart":"14px","paddingEnd":"14px"},"size":"kilo","action":{"type":"uri","label":"uri","uri":"${butUri}"}}}]`
    flexSend(1);
}

function Bout2() {
    var alt = document.getElementById("Balt").value;
    var info = document.getElementById("Binfo").value;
    var butName = document.getElementById("BbutName").value;
    var butUri = document.getElementById("BbutUri").value;
    document.getElementById("flexJson").value = `[{"type":"flex","altText":"${alt}","contents":{"type":"bubble","direction":"ltr","styles":{"header":{"separatorColor":"#ffffff"},"body":{"separator":false,"separatorColor":"#ffffff"},"footer":{"separator":false,"separatorColor":"#ffffff"}},"body":{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${info}","size":"sm","color":"#000000","weight":"regular","style":"normal","decoration":"none","wrap":true,"margin":"none"}],"spacing":"sm","backgroundColor":"#ffffff","borderColor":"#ffffff","paddingTop":"11px","paddingBottom":"7px","paddingStart":"14px","paddingEnd":"14px"},"footer":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","flex":1,"text":"${butName}","size":"xs","align":"center","gravity":"center","color":"#111111","weight":"bold","style":"normal","wrap":true,"position":"relative"}],"spacing":"11px","backgroundColor":"#f5f5f5","cornerRadius":"7px","height":"35px","action":{"type":"uri","label":"uri","uri":"${butUri}"}}],"spacing":"11px","position":"relative","paddingTop":"7px","paddingBottom":"14px","paddingStart":"14px","paddingEnd":"14px"},"size":"kilo","action":{"type":"uri","label":"uri","uri":"${butUri}"}}}]`
    logbar("jsonを出力しました");
    seikei();
}

function Vout() {
    var alt = document.getElementById("Valt").value;
    var title = document.getElementById("Vtitle").value;
    var info = document.getElementById("Vinfo").value;
    var butName = document.getElementById("VbutName").value;
    var butUri = document.getElementById("VbutUri").value;
    var uri = document.getElementById("Vuri").value;
    var imag = document.getElementById("VimgUrl").value;
    document.getElementById("flexJson").value = `[{"type":"flex","altText":"${alt}","contents":{"type":"bubble","size":"kilo","direction":"ltr","hero":{"type":"image","url":"${imag}","aspectRatio":"260:173","aspectMode":"cover","size":"full"},"body":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","weight":"bold","color":"#000000","maxLines":3,"wrap":true,"contents":[],"size":"17px","text":"${title}"},{"type":"text","text":"${info}","color":"#555555","size":"14px","margin":"5px","maxLines":3,"wrap":true,"offsetTop":"5px","offsetStart":"1px"}],"paddingTop":"12px","paddingBottom":"16px","paddingStart":"12px","paddingEnd":"12px"},{"type":"box","layout":"vertical","spacing":"none","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${butName}","color":"#42659a","size":"14px"}],"height":"57px","justifyContent":"center","alignItems":"center","action":{"type":"uri","label":"action","uri":"${butUri}"},"offsetTop":"2px"},{"type":"box","layout":"horizontal","contents":[],"width":"100%","height":"0.5px","margin":"4px","backgroundColor":"#0000000C","flex":0,"offsetBottom":"1px"},{"type":"box","layout":"horizontal","contents":[{"type":"box","layout":"horizontal","contents":[{"type":"image","url":"https://static.line-scdn.net/line_poll/edge/img/poll-flexIcon.png","align":"start","flex":0,"margin":"none","size":"16px","aspectMode":"fit","aspectRatio":"16:17"},{"type":"text","text":"投票","color":"#949494","size":"11px","align":"start","contents":[],"position":"relative","weight":"bold","margin":"6px"}],"alignItems":"center","justifyContent":"flex-start"},{"type":"image","flex":0,"align":"end","url":"https://vos.line-scdn.net/static/KOsdmDJ.png","size":"5px","aspectMode":"cover","aspectRatio":"5:8"}],"action":{"type":"uri","label":"action","uri":"https://line.me/R/share?text=運営はゴミ"},"spacing":"none","justifyContent":"space-between","alignItems":"center","paddingStart":"12px","paddingEnd":"12px","paddingTop":"10px","paddingBottom":"10px"}],"paddingAll":"none"}],"paddingAll":"none"}}}]`;
    flexSend(1);
}
function Vout2() {
    var alt = document.getElementById("Valt").value;
    var title = document.getElementById("Vtitle").value;
    var info = document.getElementById("Vinfo").value;
    var butName = document.getElementById("VbutName").value;
    var butUri = document.getElementById("VbutUri").value;
    var uri = document.getElementById("Vuri").value;
    var imag = document.getElementById("VimgUrl").value;
    document.getElementById("flexJson").value = `[{"type":"flex","altText":"${alt}","contents":{"type":"bubble","size":"kilo","direction":"ltr","hero":{"type":"image","url":"${imag}","aspectRatio":"260:173","aspectMode":"cover","size":"full"},"body":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","weight":"bold","color":"#000000","maxLines":3,"wrap":true,"contents":[],"size":"17px","text":"${title}"},{"type":"text","text":"${info}","color":"#555555","size":"14px","margin":"5px","maxLines":3,"wrap":true,"offsetTop":"5px","offsetStart":"1px"}],"paddingTop":"12px","paddingBottom":"16px","paddingStart":"12px","paddingEnd":"12px"},{"type":"box","layout":"vertical","spacing":"none","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${butName}","color":"#42659a","size":"14px"}],"height":"57px","justifyContent":"center","alignItems":"center","action":{"type":"uri","label":"action","uri":"${butUri}"},"offsetTop":"2px"},{"type":"box","layout":"horizontal","contents":[],"width":"100%","height":"0.5px","margin":"4px","backgroundColor":"#0000000C","flex":0,"offsetBottom":"1px"},{"type":"box","layout":"horizontal","contents":[{"type":"box","layout":"horizontal","contents":[{"type":"image","url":"https://static.line-scdn.net/line_poll/edge/img/poll-flexIcon.png","align":"start","flex":0,"margin":"none","size":"16px","aspectMode":"fit","aspectRatio":"16:17"},{"type":"text","text":"投票","color":"#949494","size":"11px","align":"start","contents":[],"position":"relative","weight":"bold","margin":"6px"}],"alignItems":"center","justifyContent":"flex-start"},{"type":"image","flex":0,"align":"end","url":"https://vos.line-scdn.net/static/KOsdmDJ.png","size":"5px","aspectMode":"cover","aspectRatio":"5:8"}],"action":{"type":"uri","label":"action","uri":"https://line.me/R/share?text=運営はゴミ"},"spacing":"none","justifyContent":"space-between","alignItems":"center","paddingStart":"12px","paddingEnd":"12px","paddingTop":"10px","paddingBottom":"10px"}],"paddingAll":"none"}],"paddingAll":"none"}}}]`;
    logbar("jsonを出力しました");
    seikei();
}

function Lout() {
    var alt = document.getElementById("Lalt").value;
    var title = document.getElementById("Ltitle").value;
    var info = document.getElementById("Linfo").value;
    var butName = document.getElementById("LbutName").value;
    var butUri = document.getElementById("LbutUri").value;
    var imag = document.getElementById("LimgUrl").value;
    document.getElementById("flexJson").value = `[{"type": "flex","altText": "${alt}","contents": {"type": "bubble", "size": "kilo", "body": { "type": "box", "layout": "vertical", "contents": [ { "type": "image", "url": "https://obs.line-scdn.net/0hF3YRnB6wGRxkKwtVFGNmS2t9RDIIXw0XAB9IBzlUM0I0ZSg0PSU3Dl5qGHo", "aspectRatio": "260:395", "aspectMode": "cover", "position": "absolute", "align": "end", "size": "full" }, { "type": "box", "layout": "horizontal", "contents": [ { "type": "box", "layout": "vertical", "contents": [ { "type": "box", "layout": "vertical", "contents": [ { "type": "image", "url": "https://obs.line-scdn.net/0hIYLvh3INFnZxDwQ_B4ppIXlZS1gdewJ9FTtHbQxIHCgofxVwEDESRBcQCRkK", "position": "absolute", "size": "11px", "align": "start", "offsetTop": "7px", "offsetStart": "14px" }, { "type": "text", "text": "Live talk", "size": "9px", "color": "#06C755", "weight": "bold", "offsetStart": "29px", "align": "start", "offsetBottom": "md", "position": "absolute" } ], "position": "absolute", "width": "82px", "height": "26px", "cornerRadius": "20px", "backgroundColor": "#00000040", "offsetStart": "13px", "offsetTop": "13px" }, { "type": "box", "layout": "vertical", "contents": [ { "type": "image", "url": "${imag}", "aspectMode": "cover", "size": "full" } ], "width": "95px", "height": "95px", "cornerRadius": "100px", "offsetTop": "18%", "offsetStart": "32%" }, { "type": "box", "layout": "vertical", "contents": [ { "type": "text", "text": "${title}", "margin": "none", "size": "20px", "color": "#FFFFFF", "weight": "bold", "align": "center", "wrap": true, "maxLines": 2 }, { "type": "text", "text": "${info}", "color": "#ffffff80", "margin": "sm", "size": "13px", "weight": "regular", "maxLines": 2, "align": "center", "wrap": true } ], "position": "absolute", "offsetTop": "49%", "paddingStart": "28px", "paddingEnd": "28px" }, { "type": "box", "layout": "vertical", "contents": [ { "type": "box", "layout": "baseline", "contents": [ { "type": "filler" }, { "type": "icon", "url": "https://obs.line-scdn.net/0h5s5xAax5alwIAXhwhy0VCz9XN3JkdX5XbDU7Yn9fawJ4aWpecTd4YENAdzRiYWheKyZ6bA", "size": "12px", "offsetTop": "1.5px" }, { "type": "text", "text": "${butName}", "size": "12px", "color": "#ffffff", "weight": "bold", "maxLines": 1, "flex": 0, "wrap": true }, { "type": "filler" } ], "paddingTop": "5%", "paddingBottom": "5%", "spacing": "4px" } ], "backgroundColor": "#06C755", "height": "35px", "cornerRadius": "7px", "offsetStart": "10%", "offsetEnd": "10%", "offsetBottom": "7.5%", "position": "absolute", "justifyContent": "center" }, { "type": "button", "action": { "type": "uri", "uri": "${butUri}", "label": " " }, "position": "absolute", "height": "md", "style": "link", "offsetTop": "81%", "offsetStart": "none", "offsetEnd": "none" } ], "position": "relative" } ], "offsetStart": "0px", "offsetEnd": "0px", "width": "100%", "height": "100%", "position": "absolute" } ], "paddingAll": "0px", "cornerRadius": "0px", "backgroundColor": "#2a2a2a", "height": "378px", "width": "100%" }, "styles": { "body": { "backgroundColor": "#000000" }}}}]`;
    flexSend(1);
}

function Lout2() {
    var alt = document.getElementById("Lalt").value;
    var title = document.getElementById("Ltitle").value;
    var info = document.getElementById("Linfo").value;
    var butName = document.getElementById("LbutName").value;
    var butUri = document.getElementById("LbutUri").value;
    var imag = document.getElementById("LimgUrl").value;
    document.getElementById("flexJson").value = `[{"type": "flex","altText": "${alt}","contents": {"type": "bubble", "size": "kilo", "body": { "type": "box", "layout": "vertical", "contents": [ { "type": "image", "url": "https://obs.line-scdn.net/0hF3YRnB6wGRxkKwtVFGNmS2t9RDIIXw0XAB9IBzlUM0I0ZSg0PSU3Dl5qGHo", "aspectRatio": "260:395", "aspectMode": "cover", "position": "absolute", "align": "end", "size": "full" }, { "type": "box", "layout": "horizontal", "contents": [ { "type": "box", "layout": "vertical", "contents": [ { "type": "box", "layout": "vertical", "contents": [ { "type": "image", "url": "https://obs.line-scdn.net/0hIYLvh3INFnZxDwQ_B4ppIXlZS1gdewJ9FTtHbQxIHCgofxVwEDESRBcQCRkK", "position": "absolute", "size": "11px", "align": "start", "offsetTop": "7px", "offsetStart": "14px" }, { "type": "text", "text": "Live talk", "size": "9px", "color": "#06C755", "weight": "bold", "offsetStart": "29px", "align": "start", "offsetBottom": "md", "position": "absolute" } ], "position": "absolute", "width": "82px", "height": "26px", "cornerRadius": "20px", "backgroundColor": "#00000040", "offsetStart": "13px", "offsetTop": "13px" }, { "type": "box", "layout": "vertical", "contents": [ { "type": "image", "url": "${imag}", "aspectMode": "cover", "size": "full" } ], "width": "95px", "height": "95px", "cornerRadius": "100px", "offsetTop": "18%", "offsetStart": "32%" }, { "type": "box", "layout": "vertical", "contents": [ { "type": "text", "text": "${title}", "margin": "none", "size": "20px", "color": "#FFFFFF", "weight": "bold", "align": "center", "wrap": true, "maxLines": 2 }, { "type": "text", "text": "${info}", "color": "#ffffff80", "margin": "sm", "size": "13px", "weight": "regular", "maxLines": 2, "align": "center", "wrap": true } ], "position": "absolute", "offsetTop": "49%", "paddingStart": "28px", "paddingEnd": "28px" }, { "type": "box", "layout": "vertical", "contents": [ { "type": "box", "layout": "baseline", "contents": [ { "type": "filler" }, { "type": "icon", "url": "https://obs.line-scdn.net/0h5s5xAax5alwIAXhwhy0VCz9XN3JkdX5XbDU7Yn9fawJ4aWpecTd4YENAdzRiYWheKyZ6bA", "size": "12px", "offsetTop": "1.5px" }, { "type": "text", "text": "${butName}", "size": "12px", "color": "#ffffff", "weight": "bold", "maxLines": 1, "flex": 0, "wrap": true }, { "type": "filler" } ], "paddingTop": "5%", "paddingBottom": "5%", "spacing": "4px" } ], "backgroundColor": "#06C755", "height": "35px", "cornerRadius": "7px", "offsetStart": "10%", "offsetEnd": "10%", "offsetBottom": "7.5%", "position": "absolute", "justifyContent": "center" }, { "type": "button", "action": { "type": "uri", "uri": "${butUri}", "label": " " }, "position": "absolute", "height": "md", "style": "link", "offsetTop": "81%", "offsetStart": "none", "offsetEnd": "none" } ], "position": "relative" } ], "offsetStart": "0px", "offsetEnd": "0px", "width": "100%", "height": "100%", "position": "absolute" } ], "paddingAll": "0px", "cornerRadius": "0px", "backgroundColor": "#2a2a2a", "height": "378px", "width": "100%" }, "styles": { "body": { "backgroundColor": "#000000" }}}}]`;
    logbar("jsonを出力しました");
    seikei();
}

function Oout() {
    var alt = document.getElementById("Oalt").value;
    var title = document.getElementById("Otitle").value;
    var info = document.getElementById("Oinfo").value;
    var butName = document.getElementById("ObutName").value;
    var butUri = document.getElementById("ObutUri").value;
    var uri = document.getElementById("Ourl").value;
    document.getElementById("flexJson").value = `[{"type":"flex","altText":"${alt}","contents":{"type":"bubble","direction":"ltr","styles":{"footer":{"separator":true,"separatorColor":"#F0F0F0"}},"body":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"LINEオープンチャット","size":"sm","color":"#6486e3","weight":"bold","wrap":true},{"type":"text","text":"${title}","size":"xl","color":"#000000","weight":"bold","wrap":true}],"paddingTop":"sm","paddingBottom":"sm"},{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${info}","size":"xs","color":"#555555","wrap":true}],"spacing":"sm","paddingTop":"md","paddingBottom":"md"},{"type":"box","layout":"vertical","contents":[{"type":"button","action":{"type":"uri","label":"${butName}","uri":"${butUri}"},"height":"sm"}],"paddingTop":"sm","paddingBottom":"sm"}],"spacing":"sm","paddingAll":"xl"},"footer":{"type":"box","layout":"horizontal","contents":[{"type":"box","layout":"vertical","contents":[{"type":"image","url":"https://obs.line-scdn.net/0hUoMuxuSZCkBwDCOxWCR1F0ZRASJDbhRLUi4acwFbDC8JaU0eHjpAL1INEXEPaU4THm0S","size":"full","position":"absolute","offsetTop":"0px","offsetBottom":"0px","offsetStart":"0px","offsetEnd":"0px"},{"type":"image","url":"https://vos.line-scdn.net/service-notifier/footer_profile_layer.png","size":"full","position":"absolute","offsetTop":"0px","offsetBottom":"0px","offsetStart":"0px","offsetEnd":"0px"}],"width":"20px","height":"20px"},{"type":"text","text":"LINE My inquiries","size":"xs","gravity":"center","color":"#999999","weight":"bold"},{"type":"box","layout":"horizontal","contents":[{"type":"image","url":"https://vos.line-scdn.net/service-notifier/footer_go_btn.png","size":"full","gravity":"center"}],"width":"12px"}],"spacing":"md","action":{"type":"uri","label":"action","uri":"${uri}"}},"size":"kilo"}}]`;
    flexSend(1);
}
function Oout2() {
    var alt = document.getElementById("Oalt").value;
    var title = document.getElementById("Otitle").value;
    var info = document.getElementById("Oinfo").value;
    var butName = document.getElementById("ObutName").value;
    var butUri = document.getElementById("ObutUri").value;
    var uri = document.getElementById("Ourl").value;
    document.getElementById("flexJson").value = `[{"type":"flex","altText":"${alt}","contents":{"type":"bubble","direction":"ltr","styles":{"footer":{"separator":true,"separatorColor":"#F0F0F0"}},"body":{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"LINEオープンチャット","size":"sm","color":"#6486e3","weight":"bold","wrap":true},{"type":"text","text":"${title}","size":"xl","color":"#000000","weight":"bold","wrap":true}],"paddingTop":"sm","paddingBottom":"sm"},{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${info}","size":"xs","color":"#555555","wrap":true}],"spacing":"sm","paddingTop":"md","paddingBottom":"md"},{"type":"box","layout":"vertical","contents":[{"type":"button","action":{"type":"uri","label":"${butName}","uri":"${butUri}"},"height":"sm"}],"paddingTop":"sm","paddingBottom":"sm"}],"spacing":"sm","paddingAll":"xl"},"footer":{"type":"box","layout":"horizontal","contents":[{"type":"box","layout":"vertical","contents":[{"type":"image","url":"https://obs.line-scdn.net/0hUoMuxuSZCkBwDCOxWCR1F0ZRASJDbhRLUi4acwFbDC8JaU0eHjpAL1INEXEPaU4THm0S","size":"full","position":"absolute","offsetTop":"0px","offsetBottom":"0px","offsetStart":"0px","offsetEnd":"0px"},{"type":"image","url":"https://vos.line-scdn.net/service-notifier/footer_profile_layer.png","size":"full","position":"absolute","offsetTop":"0px","offsetBottom":"0px","offsetStart":"0px","offsetEnd":"0px"}],"width":"20px","height":"20px"},{"type":"text","text":"LINE My inquiries","size":"xs","gravity":"center","color":"#999999","weight":"bold"},{"type":"box","layout":"horizontal","contents":[{"type":"image","url":"https://vos.line-scdn.net/service-notifier/footer_go_btn.png","size":"full","gravity":"center"}],"width":"12px"}],"spacing":"md","action":{"type":"uri","label":"action","uri":"${uri}"}},"size":"kilo"}}]`;
    logbar("jsonを出力しました");
    seikei();
}
function Iout() {
    var alt = document.getElementById("Ialt").value;
    var title = document.getElementById("Ititle").value;
    var info = document.getElementById("Iinfo").value;
    var butName = document.getElementById("IbutName").value;
    var butUri = document.getElementById("IbutUri").value;
    var imag = document.getElementById("IimgUrl").value;
    document.getElementById("flexJson").value = `[{"type": "flex","altText": "${alt}","contents":{"type":"bubble","size":"kilo","body":{"type":"box","layout":"vertical","contents":[{"type":"image","url":"${imag}","size":"full","aspectMode":"cover","aspectRatio":"260:328","align":"end"},{"type":"image","url":"https://obs.line-scdn.net/0hI5cYsbLMFhpeID8D4iVpTVx2SzQyVAIROhRHKSN8Ji5yflJTIxkP","size":"full","aspectRatio":"260:328","align":"end","aspectMode":"cover","position":"absolute"},{"type":"image","url":"https://obs.line-scdn.net/0hJ44fB5PeFRsJHzwCtGJqTDxJSDVlawEQbStEA21LFHl9fxcjdzEGLnJCTlomZk0Mai8","size":"full","aspectMode":"cover","aspectRatio":"260:328","align":"end","position":"absolute"},{"type":"box","layout":"horizontal","contents":[{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${title}","size":"lg","color":"#FFFFFF","weight":"bold","maxLines":4,"wrap":true,"margin":"none","align":"start"},{"type":"text","text":"${info}","color":"#ffffff","size":"xs","weight":"regular","margin":"sm"}],"offsetStart":"16.92%","offsetEnd":"17.31%","position":"absolute","offsetTop":"25%"},{"type":"box","layout":"baseline","contents":[{"type":"text","text":"${butName}","color":"#ffffff","weight":"bold","size":"sm","gravity":"center"},{"type":"icon","url":"https://obs.line-scdn.net/0hQpG1rFeGDl96SCdGxgZxCHUeU3EWPBpUHnxfaRwLDik5KwxWRV9DcEAJDzk","position":"relative","size":"xxs"}],"position":"absolute","offsetTop":"83.84%","spacing":"xxl","width":"100%","paddingStart":"16.92%","paddingEnd":"17.31%"},{"type":"button","action":{"type":"uri","label":" ","uri":"${butUri}"},"style":"link","height":"md","offsetTop":"79.26%","position":"absolute","offsetStart":"none","offsetEnd":"none"}],"position":"relative"}],"position":"absolute","offsetStart":"0px","offsetEnd":"0px","width":"100%","height":"100%"}],"paddingAll":"0px","width":"100%","height":"100%","backgroundColor":"#aaaaaa00"}}}]`;
    
    flexSend(1);
}
function Iout2() {
    var alt = document.getElementById("Ialt").value;
    var title = document.getElementById("Ititle").value;
    var info = document.getElementById("Iinfo").value;
    var butName = document.getElementById("IbutName").value;
    var butUri = document.getElementById("IbutUri").value;
    var imag = document.getElementById("IimgUrl").value;
    document.getElementById("flexJson").value = `[{"type": "flex","altText": "${alt}","contents":{"type":"bubble","size":"kilo","body":{"type":"box","layout":"vertical","contents":[{"type":"image","url":"${imag}","size":"full","aspectMode":"cover","aspectRatio":"260:328","align":"end"},{"type":"image","url":"https://obs.line-scdn.net/0hI5cYsbLMFhpeID8D4iVpTVx2SzQyVAIROhRHKSN8Ji5yflJTIxkP","size":"full","aspectRatio":"260:328","align":"end","aspectMode":"cover","position":"absolute"},{"type":"image","url":"https://obs.line-scdn.net/0hJ44fB5PeFRsJHzwCtGJqTDxJSDVlawEQbStEA21LFHl9fxcjdzEGLnJCTlomZk0Mai8","size":"full","aspectMode":"cover","aspectRatio":"260:328","align":"end","position":"absolute"},{"type":"box","layout":"horizontal","contents":[{"type":"box","layout":"vertical","contents":[{"type":"box","layout":"vertical","contents":[{"type":"text","text":"${title}","size":"lg","color":"#FFFFFF","weight":"bold","maxLines":4,"wrap":true,"margin":"none","align":"start"},{"type":"text","text":"${info}","color":"#ffffff","size":"xs","weight":"regular","margin":"sm"}],"offsetStart":"16.92%","offsetEnd":"17.31%","position":"absolute","offsetTop":"25%"},{"type":"box","layout":"baseline","contents":[{"type":"text","text":"${butName}","color":"#ffffff","weight":"bold","size":"sm","gravity":"center"},{"type":"icon","url":"https://obs.line-scdn.net/0hQpG1rFeGDl96SCdGxgZxCHUeU3EWPBpUHnxfaRwLDik5KwxWRV9DcEAJDzk","position":"relative","size":"xxs"}],"position":"absolute","offsetTop":"83.84%","spacing":"xxl","width":"100%","paddingStart":"16.92%","paddingEnd":"17.31%"},{"type":"button","action":{"type":"uri","label":" ","uri":"${butUri}"},"style":"link","height":"md","offsetTop":"79.26%","position":"absolute","offsetStart":"none","offsetEnd":"none"}],"position":"relative"}],"position":"absolute","offsetStart":"0px","offsetEnd":"0px","width":"100%","height":"100%"}],"paddingAll":"0px","width":"100%","height":"100%","backgroundColor":"#aaaaaa00"}}}]`;
    logbar("jsonを出力しました");
    seikei();
}
function Cout() {
    var alt = document.getElementById("Calt").value;
    var title = document.getElementById("Ctitle").value;
    var info = document.getElementById("Cinfo").value;
    var imag = document.getElementById("CimgUrl").value;
    var butName = document.getElementById("CbutName").value;
    var butUri = document.getElementById("CbutUri").value;
    document.getElementById("flexJson").value = `[{"type":"template","altText":"${alt}","template":{"type":"buttons","thumbnailImageUrl":"${imag}","imageAspectRatio": "rectangle","imageSize":"cover","imageBackgroundColor":"#FFFFFF","title":"${title}","text":"${info}","actions":[{"type":"uri","label":"${butName}","uri":"${butUri}"}]}}]`;
    flexSend(1);
}
function Cout2() {
    var alt = document.getElementById("Calt").value;
    var title = document.getElementById("Ctitle").value;
    var info = document.getElementById("Cinfo").value;
    var imag = document.getElementById("CimgUrl").value;
    var butName = document.getElementById("CbutName").value;
    var butUri = document.getElementById("CbutUri").value;
    document.getElementById("flexJson").value = `[{"type":"template","altText":"${alt}","template":{"type":"buttons","thumbnailImageUrl":"${imag}","imageAspectRatio": "rectangle","imageSize":"cover","imageBackgroundColor":"#FFFFFF","title":"${title}","text":"${info}","actions":[{"type":"uri","label":"${butName}","uri":"${butUri}"}]}}]`;
    logbar("jsonを出力しました");
    seikei();
}
function addoclist(del) {
    if (del=="del") {
        document.getElementById("oclist").contentWindow.document.getElementById("squarelists").innerHTML=""
        return
    }
    let url=document.getElementById("oclisturl").value;
    let octime=document.getElementById("octime").value;
    let role=document.getElementById("memtype").value;
    let type = "不正なurlです";
    let tic;
    let urll = 0;
    url = url.replace("line.me/ti/g2/", "line://ti/g2/");
    url = url.replace("line.me/S/", "line://");
    url = url.replace("line.me/R/", "line://");
    url = url.replace("line.naver.jp/R/", "line://");
    url = url.replace("line.naver.jp/S/", "line://");
    url = url.replace("http://", "");
    url = url.replace("https://", "");
    urll = url.lastIndexOf("line://");
    url = url.substr(urll);
    if (url.substr(7, 6) == "ti/g2/") {
        type = "招待リンク";
        let s = url.substr(13);
        tic = "";
        for (var i = 0; i < s.length; ++i) {
            if (s.charAt(i) == "?") {
                break
            } else {
                tic = tic + s.charAt(i)
            }
        }
    } else if (url.substr(7, 14) == "square/report?") {
        type = "通報リンク";
        tic = "";
        let s = url.substr(21);
        s = s.substr(s.lastIndexOf("ticket=") + 7);
        s = s + "&";
        s = s.substring(0, s.indexOf("&"));
        tic = s;
    } else if (url.substr(7, 12) == "square/join?") {
        type = "参加リンク";
        tic = "";
        let s = url.substr(19);
        s = s.substr(s.lastIndexOf("ticket=") + 7);
        s = s + "&";
        s = s.substring(0, s.indexOf("&"));
        tic = s;
    }
    if (tic) {
        logbar("オープンチャットを読み込んでいます...")
    fetch("https://piloking-api.deno.dev/"+tic).then((res)=>res.json()).then((json)=>{
        if(json.err){
            document.getElementById("ocview").innerHTML = ``;
            errbar("オープンチャットを読み込めませんでした: エラー "+json.err)
        }else{
        logbar("オープンチャットを読み込みました")
        let oclist=document.createElement("li");
        oclist.innerHTML=`
                                <div>
                                    <div class="square_img">
                                        <img src="https://obs.line-scdn.net/${json.obs}/preview.100x100" alt="img" style="object-fit: cover;">
                                        <span class="badge">
                                            <span class="${role}">
                                                <span class="blind">role</span>
                                            </span>
                                        </span>
                                    </div>
                                    <div class="square_info">
                                        <span class="name ">
                                            <span class="txt">${json.title}</span>
                                        </span>
                                        <span class="desc">${json.desc}</span>
                                        <span class="update">${octime}</span>
                                    </div>
                                </div>
                                <button type="button" class="btn_favorite">
                                    <span class="blind">favorite</span>
                                </button>
                                <button type="button" class="area_link" ></button>
                            `
        document.getElementById("oclist").contentWindow.document.getElementById("squarelists").appendChild(oclist)
}})
    } else {
        errbar("不正なurlです")
    }    
}
            </script>
    </body>
</html>